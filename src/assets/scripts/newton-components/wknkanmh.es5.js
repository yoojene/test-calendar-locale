/*! Built with http://stenciljs.com */
NewtonComponents.loadBundle("wknkanmh",["exports"],function(t){var e=window.NewtonComponents.h,i={CHART_TYPE_LINE:"line",CHART_TYPE_BAR:"bar",CHART_TYPE_ARRAY:[{id:"line",value:"Line"},{id:"bar",value:"Bar"}],GROUP_DATA_HOUR:"hour",GROUP_DATA_DAY:"day",GROUP_DATA_WEEK:"week",GROUP_DATA_MONTH:"month",GROUP_DATA_YEAR:"year",GROUP_DATA_ARRAY:[{id:"hour",value:"Hour"},{id:"day",value:"Day"},{id:"week",value:"Week"},{id:"month",value:"Month"},{id:"year",value:"Year"}],SWIPE_RIGHT:"Right",SWIPE_LEFT:"left",DEFINE_SWIPE_ACT:100},a=function(){function t(){this.chartOption={},this.type=i.CHART_TYPE_BAR,this.groupData=i.GROUP_DATA_DAY,this.limit=400,this.useSlot=!1,this.timeZone=Intl.DateTimeFormat().resolvedOptions().timeZone,this.eventsArray=null,this.swipeIndex=0,this.option={order:"desc",orderBy:"createTime"},this.chartTypeArray=i.CHART_TYPE_ARRAY,this.groupDataArray=i.GROUP_DATA_ARRAY,this.selectChartType=null,this.selectGroupData=null,this.startPageX=0,this.swipeLimitLeft=!1}return t.prototype.componentWillLoad=function(){this.isServer||("undefined"!=typeof newtonService?"undefined"!=typeof Chart?this.logIn():console.error("Chart.js not installed, please install http://www.chartjs.org/ and bind it to the window."):console.error("Newton Service not installed, please install @pfizer/newton-js-sdk and bind it to the window."))},t.prototype.componentDidUpdate=function(){this.addChart()},t.prototype.startSwipe=function(t){if("dragstart"===t.type)t.dataTransfer.setDragImage(new Image,0,0),this.startPageX=t.pageX;else{var e=t.changedTouches[0];this.startPageX=e.pageX}},t.prototype.finishSwipe=function(t){this.setSwipeLeftorRight(t),this.touchDirection&&this.updateTargetContent()},t.prototype.logIn=function(){var t=this;this.isServer||newtonService.service("auth").loginViaEmail("test33@alextheward.com","password1").then(function(e){t.getNewtonEvents()})},t.prototype.setSwipeLeftorRight=function(t){var e=("dragend"===t.type?t.pageX:t.changedTouches[0].pageX)-this.startPageX;this.touchDirection=e<-i.DEFINE_SWIPE_ACT?i.SWIPE_RIGHT:e>i.DEFINE_SWIPE_ACT?i.SWIPE_LEFT:""},t.prototype.updateTargetContent=function(){this.touchDirection===i.SWIPE_RIGHT&&this.swipeIndex-this.limit>=0?(this.swipeIndex=this.swipeIndex-this.limit,this.getNewtonEvents()):this.touchDirection!==i.SWIPE_LEFT||this.swipeLimitLeft||(this.swipeIndex=this.swipeIndex+this.limit,this.getNewtonEvents())},t.prototype.getNewtonEvents=function(){var t=this;this.setOption(),newtonService.service("event").get(this.option).then(function(e){0===e.length?(t.touchDirection===i.SWIPE_RIGHT?t.swipeIndex=t.swipeIndex+t.limit:(t.swipeLimitLeft=!0,t.swipeIndex=t.swipeIndex-t.limit),t.requestEventDataNotFound.emit({message:"Data not Found."})):(t.selectGroupData=t.selectGroupData?t.selectGroupData:t.groupData,t.selectChartType=t.selectChartType?t.selectChartType:t.type,t.swipeLimitLeft=!1,t.eventsArray=e)})},t.prototype.setOption=function(){this.option.payloadFilters="eventType="+this.eventType,this.option.limit=this.limit,this.option.offset=this.swipeIndex},t.prototype.groupDataChanged=function(t){this.selectGroupData=t.srcElement.value,this.addChart()},t.prototype.chartTypeChanged=function(t){this.selectChartType=t.srcElement.value,this.addChart()},t.prototype.addChart=function(){var t=this.getData(),e=this.getChartLabel();this.chartObject?this.updateChartObject(t,e):this.createChart(t,e)},t.prototype.updateChartObject=function(t,e){this.chartObject.config.data.datasets[0].data=t.yData,this.chartObject.config.data.datasets[0].label=e,this.chartObject.config.data.labels=t.xData,this.chartObject.config.type=this.selectChartType,this.chartObject.update()},t.prototype.createChart=function(t,e){var i=this.chart.querySelector("#time-line-chart--canvas");this.chartOption.label=e,this.chartOption.data=t.yData,this.chartObject=new Chart(i,{type:this.selectChartType,data:{labels:t.xData,datasets:[this.chartOption]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}})},t.prototype.getChartLabel=function(){var t=this.yAxis.split(".");return"Number of "+t[t.length-1]+" grouped by "+this.selectGroupData},t.prototype.getData=function(){var t={yData:[],xData:[]},e=function(t,e,a){return t.reduce(function(t,n){void 0===t&&(t=[]);var r=new Date(new Date(n.createTime).toLocaleString("en-US",{timeZone:a.timeZone})),o=new Intl.DateTimeFormat("en-US",{month:"long"}).format(r),s=""+r.getFullYear();e===i.GROUP_DATA_DAY?s=s+"-"+o+"-"+r.getDate():e===i.GROUP_DATA_WEEK?s=a.getWeeksInMonth(r.getDate(),r.getMonth(),r.getFullYear(),s+"-"+o):e===i.GROUP_DATA_MONTH?s=s+"-"+o:e===i.GROUP_DATA_HOUR&&(s=s+"-"+o+"-"+r.getDate()+" "+r.getHours()+":00");var h=a.getYorderlyData(n),p=t[s];return t[s]?t[s]=p+h:t[s]=h,t},this)}(this.eventsArray,this.selectGroupData,this);return t.xData=Object.keys(e).reverse(),t.yData=Object.keys(e).map(function(t){return e[t]}).reverse(),t},t.prototype.getYorderlyData=function(t){try{var e=this.yAxis.split("."),i=null;return 1===e.length?i=t[e[0]]:(i=t.attributes,e.forEach(function(t){i=i[t]})),i}catch(t){return null}},t.prototype.getWeeksInMonth=function(t,e,i,a){for(var n=new Date(i,e+1,0).getDate(),r=7-new Date(i,e,1).getDay(),o=1,s=1;o<=n;){if(t>=o&&t<=r)return"week-"+s+" -"+a;o=r+1,s++,(r+=7)>n&&(r=n)}},t.prototype.render=function(){var t=this;return e("div",null,null!==this.eventsArray?e("div",{class:"time-line-chart",draggable:!0,onDragStart:this.startSwipe.bind(this),onDragEnd:this.finishSwipe.bind(this),onTouchStart:this.startSwipe.bind(this),onTouchEnd:this.finishSwipe.bind(this)},e("canvas",{id:"time-line-chart--canvas",class:"time-line-chart--canvas"}),e("select",{class:"time-line-chart--select",onChange:function(e){return t.groupDataChanged(e)}},this.groupDataArray.map(function(i){return i.id===t.selectGroupData?e("option",{value:i.id,selected:!0},i.value):e("option",{value:i.id},i.value)})),e("select",{class:"time-line-chart--select",onChange:function(e){return t.chartTypeChanged(e)}},this.chartTypeArray.map(function(i){return i.id===t.selectChartType?e("option",{value:i.id,selected:!0},i.value):e("option",{value:i.id},i.value)}))):this.useSlot?e("div",null,e("slot",{name:"display-no-data"})):e("div",null,"No data"))},Object.defineProperty(t,"is",{get:function(){return"newton-timeline"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{chart:{elementRef:!0},chartOption:{type:"Any",attr:"chart-option"},eventsArray:{state:!0},eventType:{type:String,attr:"event-type"},groupData:{type:String,attr:"group-data"},isServer:{context:"isServer"},limit:{type:Number,attr:"limit"},timeZone:{type:String,attr:"time-zone"},type:{type:String,attr:"type"},useSlot:{type:Boolean,attr:"use-slot"},yAxis:{type:String,attr:"y-axis"}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"events",{get:function(){return[{name:"requestEventDataNotFound",method:"requestEventDataNotFound",bubbles:!0,cancelable:!0,composed:!0}]},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return".time-line-chart{width:800px!important;height:500px!important}"},enumerable:!0,configurable:!0}),t}();t.NewtonTimeline=a,Object.defineProperty(t,"__esModule",{value:!0})});